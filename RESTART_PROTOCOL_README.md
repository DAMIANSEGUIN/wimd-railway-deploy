# AI Session Restart Protocol

**Created:** 2025-11-26
**Purpose:** Eliminate repetitive manual onboarding every session

---

## Quick Reference

### Ending a Session (AI or Human)

```bash
./scripts/session_end.sh
```

**What it does:**
- Captures current work state
- Records blockers and next steps
- Creates AI_RESUME_STATE.md (single source of truth)
- Generates handoff manifest
- Optionally commits changes

---

### Starting a New Session (For You)

**Option 1: Short Prompt (Try this first)**
```
cd /Users/damianseguin/AI_Workspace/WIMD-Railway-Deploy-Project && ./scripts/show_latest_context.sh

Then tell Claude Code to choose option 2.
```

**Option 2: Detailed Prompt (If short fails)**

Copy and paste from: `AI_DETAILED_PROMPT.txt`

---

## Files Created

### `/scripts/session_end.sh`
- Run at end of every session
- Interactive prompts for work summary, status, blockers
- Creates AI_RESUME_STATE.md
- Creates handoff manifest in .ai-agents/
- Optionally commits changes

### `/scripts/show_latest_context.sh`
- Run at start of every session
- Option 1: Quick resume (AI_RESUME_STATE.md only)
- Option 2: Full context (resume + handoffs + git + health)
- Option 3: Exit

### `AI_RESUME_STATE.md`
- **Generated by session_end.sh**
- Single source of truth for session state
- Contains: last work, status, blockers, next steps, modified files
- Includes both short and detailed prompts for next AI
- **Git-tracked** (survives across sessions)

### `AI_SHORT_PROMPT.txt`
- Minimal instruction for restarting AI
- Test this version first

### `AI_DETAILED_PROMPT.txt`
- Full context version
- Use if short prompt doesn't work

---

## How It Works

### Session End Flow

```
AI working → Human says "end session" → AI runs ./scripts/session_end.sh
                                           ↓
                                   Prompts for summary
                                           ↓
                                   Captures state
                                           ↓
                                   Writes AI_RESUME_STATE.md
                                           ↓
                                   Creates handoff manifest
                                           ↓
                                   Optional: git commit
```

### Session Start Flow

```
Human opens new AI → Pastes command → AI runs ./scripts/show_latest_context.sh
                                           ↓
                                   Chooses option 2 (Full Context)
                                           ↓
                                   Reads AI_RESUME_STATE.md
                                           ↓
                                   Reads latest 3 handoffs
                                           ↓
                                   Checks git status
                                           ↓
                                   Checks backend health
                                           ↓
                                   Asks user: "Continue with X?"
```

---

## Testing Protocol

### Test 1: Short Prompt
1. End this session: `./scripts/session_end.sh`
2. Restart Claude Code (new session)
3. Use short prompt from `AI_SHORT_PROMPT.txt`
4. **Success if:** AI loads context and asks about continuing work
5. **Failure if:** AI confused, can't find files, or asks basic questions

### Test 2: Detailed Prompt (if Test 1 fails)
1. End this session: `./scripts/session_end.sh`
2. Restart Claude Code (new session)
3. Use detailed prompt from `AI_DETAILED_PROMPT.txt`
4. **Success if:** AI loads full context and understands project state
5. **Failure if:** Still confused (protocol needs redesign)

---

## What Gets Captured

**From session_end.sh:**
- Agent name (Claude-Code, Gemini, Cursor)
- Work summary (what were you doing)
- Status (done/in-progress/blocked)
- Blocker description (if blocked)
- Next steps (if not done)
- Current branch
- Modified files
- Recent commits
- Backend health status

**Available at session start:**
- All captured state above
- Latest 3 handoff documents
- Current git status
- Backend health check
- Modified files list

---

## Advantages Over Previous System

### Old Way
- ❌ AI had to remember to read 10+ documents
- ❌ You had to explain the same things every session
- ❌ No single source of truth
- ❌ Scattered state across multiple files
- ❌ AIs often skipped critical context

### New Way
- ✅ Single command to load everything
- ✅ One file (AI_RESUME_STATE.md) contains state
- ✅ Automatic state capture at session end
- ✅ Git-tracked (survives restarts)
- ✅ Includes both short and detailed prompts
- ✅ Backend health checked automatically

---

## Troubleshooting

### AI doesn't understand short prompt
→ Use AI_DETAILED_PROMPT.txt instead

### AI_RESUME_STATE.md doesn't exist
→ Previous session didn't end properly
→ Fallback: AI should read latest handoff in .ai-agents/

### Scripts aren't executable
```bash
chmod +x scripts/session_end.sh scripts/show_latest_context.sh
```

### Backend health check fails
→ Script continues anyway
→ Health status marked as "unknown" in state file

---

## Future Enhancements

### Potential Improvements
1. **Git hook automation** - Auto-run session_end.sh on commit
2. **Pre-commit state capture** - Update AI_RESUME_STATE.md automatically
3. **Health check validation** - Block session end if critical issues
4. **Multi-AI state tracking** - Track which AI did what work
5. **State diff** - Show what changed since last session

---

## Files Modified

New files created:
- `scripts/session_end.sh`
- `scripts/show_latest_context.sh`
- `AI_SHORT_PROMPT.txt`
- `AI_DETAILED_PROMPT.txt`
- `RESTART_PROTOCOL_README.md` (this file)

Generated files (created by scripts):
- `AI_RESUME_STATE.md` (created by session_end.sh)
- `.ai-agents/handoff_YYYYMMDD_HHMMSS.json` (created by session_end.sh)

---

## Next Steps

1. **Test the short prompt** (see Testing Protocol above)
2. **If short fails, test detailed prompt**
3. **Report results**: Which version worked?
4. **Iterate if needed**: Adjust prompts based on what works

---

**Status:** Ready for testing
**Last Updated:** 2025-11-26
