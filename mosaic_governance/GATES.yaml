description: Mosaic Platform Governance Gates - Machine-parseable, enforceable across
  all contexts
gates:
- aliases: []
  condition: git_remote_equals_authority_map_repo()
  description: Git remote must match authority_map.json repo declaration
  domain: repo_hook
  enforcement_mode: MODE=local,ci,runtime
  fail_action: REJECT
  id: REPO_REMOTE_MATCH
  name: Repository Remote Match
  pass_criteria: Git remote URL matches authority_map.json repo.github_owner and repo.github_repo
  severity: CRITICAL
  source_refs:
  - docs/MOSAIC_CANON_GOVERNANCE_REWRITE__DETERMINISTIC_GATES.md
  trigger: always
- aliases: []
  condition: git_branch_equals(authority_map.repo.branch)
  description: Git branch must match authority_map.json branch declaration
  domain: repo_hook
  enforcement_mode: MODE=local,ci,runtime
  fail_action: REJECT
  id: BRANCH_MATCH
  name: Branch Match
  pass_criteria: Current git branch matches authority_map.json repo.branch
  severity: CRITICAL
  source_refs:
  - docs/MOSAIC_CANON_GOVERNANCE_REWRITE__DETERMINISTIC_GATES.md
  trigger: always
- aliases: []
  condition: git_status_is_clean_or_explicitly_allowed()
  description: Git worktree must be clean or explicitly allowed
  domain: repo_hook
  enforcement_mode: MODE=local,ci,runtime
  fail_action: REJECT
  id: CLEAN_WORKTREE
  name: Clean Worktree
  pass_criteria: No uncommitted changes or changes are explicitly allowed
  severity: HIGH
  source_refs:
  - docs/MOSAIC_CANON_GOVERNANCE_REWRITE__DETERMINISTIC_GATES.md
  trigger: always
- aliases: []
  condition: runtime_commit_equals_git_sha(runtime_url + identity_path, git_sha(HEAD),
    timeout=5)
  description: Runtime deployed commit must match git HEAD SHA
  domain: runtime_watchdog
  enforcement_mode: MODE=ci
  fail_action: REJECT on SHA mismatch, CLARIFY_REQUIRED on network failure
  id: RUNTIME_IDENTITY_MATCH
  name: Runtime Identity Match
  on_network_failure: CLARIFY_REQUIRED
  pass_criteria: Deployed service reports same commit SHA as local HEAD
  severity: CRITICAL
  source_refs:
  - docs/MOSAIC_CANON_GOVERNANCE_REWRITE__DETERMINISTIC_GATES.md
  trigger: mode_is(ci)
- aliases: []
  condition: runtime_self_reports_commit_equals_env(GIT_SHA)
  description: Runtime service must report its deployed commit via env var
  domain: runtime_watchdog
  enforcement_mode: MODE=runtime
  fail_action: REJECT
  id: RUNTIME_SELF_ATTEST
  name: Runtime Self Attestation
  pass_criteria: Service has GIT_SHA environment variable set at build time
  severity: CRITICAL
  source_refs:
  - docs/MOSAIC_CANON_GOVERNANCE_REWRITE__DETERMINISTIC_GATES.md
  trigger: mode_is(runtime)
- aliases:
  - Session Start Protocol
  - Startup Validator
  condition: agent_first_response_contains_evidence_of(state_files_read, handoff_read,
    validation_run, git_state_checked, features_verified)
  description: Validates AI agent executed mandatory startup protocol
  domain: human_check
  enforcement_mode: manual
  fail_action: Auto-generate redirect with missing evidence and required commands
  id: GATE_1_SESSION_START
  name: Session Start Validator
  pass_criteria: Agent shows evidence of reading state files, handoff, running validation,
    checking git, verifying features
  script: .mosaic/enforcement/gate_1_session_start.py
  severity: CRITICAL
  source_refs:
  - .mosaic/enforcement/FOUR_GATE_SYSTEM.md
  - .mosaic/enforcement/gate_1_session_start.py
  trigger: new_ai_session_start
- aliases:
  - Behavioral Protocol Validator
  condition: response_does_not_contain_forbidden_patterns_without_required_context
  description: Blocks forbidden behavioral patterns in agent responses
  domain: human_check
  enforcement_mode: manual
  fail_action: Auto-generate redirect with documents to read and evidence required
  forbidden_patterns:
  - requires_context:
    - 'Last agent:'
    - 'Last commit:'
    - 'Handoff message:'
    severity: CRITICAL
    trigger: what would you like me to work on
    violation_type: ASKED_FOR_DIRECTION_WITHOUT_READING_STATE
  - requires_context:
    - tests passed
    - Validation tests passed
    severity: CRITICAL
    trigger: work complete
    violation_type: CLAIMED_COMPLETE_WITHOUT_VALIDATION
  - requires_context:
    - 'Health check:'
    - 'Production state:'
    severity: HIGH
    trigger: should i deploy
    violation_type: ASKED_ABOUT_DEPLOY_WITHOUT_CHECKING_STATE
  - requires_context:
    - 'INTENT:'
    - Planning to
    - Going to
    severity: MEDIUM
    trigger: i'll update the
    violation_type: ACTION_WITHOUT_INTENT_DECLARATION
  id: GATE_2_BEHAVIOR_LINT
  name: Behavior Lint Validator
  pass_criteria: No forbidden phrases without required context (e.g., 'what would you
    like me to work on' without showing state files)
  script: .mosaic/enforcement/gate_2_behavior_lint.py
  severity: CRITICAL
  source_refs:
  - .mosaic/enforcement/FOUR_GATE_SYSTEM.md
  - .mosaic/enforcement/gate_2_behavior_lint.py
  trigger: any_agent_response
- aliases:
  - Gate 3.1
  - Absolute Path Check
  condition: no_absolute_paths_in_markdown_files
  description: Markdown files must use relative paths only
  domain: repo_hook
  enforcement_mode: automatic
  fail_action: BLOCK commit with violation details
  id: GATE_3_1_NO_ABSOLUTE_PATHS
  name: No Absolute Paths in Documentation
  pass_criteria: 'No /Users/, /home/, C:\, or /private/ paths in .md files (except
    in example/documentation blocks)'
  script: .mosaic/enforcement/pre-commit
  severity: CRITICAL
  source_refs:
  - .mosaic/enforcement/pre-commit
  - .ai-agents/CROSS_AGENT_PROTOCOL.md
  trigger: git_commit
- aliases:
  - Gate 3.2
  - Database Pattern Check
  condition: all_get_conn_uses_context_manager
  description: Python database operations must use context manager pattern
  domain: repo_hook
  enforcement_mode: automatic
  fail_action: BLOCK commit with pattern violation details
  id: GATE_3_2_CONTEXT_MANAGER
  name: Context Manager Pattern
  pass_criteria: "All Python files use 'with get_conn() as conn:' not 'conn = get_conn()'"
  script: .mosaic/enforcement/pre-commit
  severity: CRITICAL
  source_refs:
  - .mosaic/enforcement/pre-commit
  - TROUBLESHOOTING_CHECKLIST.md
  trigger: git_commit
- aliases:
  - Gate 3.3
  - SQL Syntax Check
  condition: no_sqlite_syntax_in_python
  description: Python files must use PostgreSQL syntax, not SQLite
  domain: repo_hook
  enforcement_mode: automatic
  fail_action: BLOCK commit on AUTOINCREMENT, WARN on ? placeholders
  id: GATE_3_3_POSTGRESQL_SYNTAX
  name: PostgreSQL Syntax
  pass_criteria: Python files use %s placeholders (not ?), SERIAL (not AUTOINCREMENT)
  script: .mosaic/enforcement/pre-commit
  severity: HIGH
  source_refs:
  - .mosaic/enforcement/pre-commit
  - TROUBLESHOOTING_CHECKLIST.md
  trigger: git_commit
- aliases:
  - Gate 3.4
  - Schema Validation
  condition: state_files_valid_json_with_required_fields
  description: JSON state files must be valid and contain required fields
  domain: repo_hook
  enforcement_mode: automatic
  fail_action: BLOCK commit with JSON validation errors
  id: GATE_3_4_STATE_SCHEMA
  name: State File Schema Validation
  pass_criteria: .mosaic/*.json files are valid JSON with required fields (version,
    last_agent, last_commit, etc.)
  script: .mosaic/enforcement/pre-commit
  severity: HIGH
  source_refs:
  - .mosaic/enforcement/pre-commit
  trigger: git_commit
- aliases:
  - Gate 3.5
  - State Update Check
  condition: agent_state_updated_when_code_changed
  description: Agent state file must be updated when code changes
  domain: repo_hook
  enforcement_mode: automatic
  fail_action: WARN (not block) if state not updated
  id: GATE_3_5_AGENT_STATE_UPDATED
  name: Agent State Updated
  pass_criteria: If api/, mosaic_ui/, or scripts/*.py changed, .mosaic/agent_state.json
    is also staged
  script: .mosaic/enforcement/pre-commit
  severity: MEDIUM
  source_refs:
  - .mosaic/enforcement/pre-commit
  trigger: git_commit
- aliases:
  - Gate 3.6
  - Secret Detection
  condition: no_secrets_in_staged_files
  description: Commits must not contain API keys, passwords, or connection strings
  domain: repo_hook
  enforcement_mode: automatic
  fail_action: BLOCK commit with secret pattern matches
  id: GATE_3_6_NO_SECRETS
  name: No Secrets in Commits
  pass_criteria: No OPENAI_API_KEY, CLAUDE_API_KEY, DATABASE_URL, passwords in committed
    files (except examples/REDACTED)
  script: .mosaic/enforcement/pre-commit
  severity: CRITICAL
  source_refs:
  - .mosaic/enforcement/pre-commit
  trigger: git_commit
- aliases:
  - Gate 3.7
  - Commit Format Check
  condition: commit_message_conventional_format
  description: Commit messages should follow conventional commits format
  domain: repo_hook
  enforcement_mode: automatic
  fail_action: WARN (not block) if format not followed
  id: GATE_3_7_COMMIT_MESSAGE
  name: Commit Message Format
  pass_criteria: 'Commit message starts with type(scope): message (feat, fix, docs,
    etc.)'
  script: .mosaic/enforcement/pre-commit
  severity: LOW
  source_refs:
  - .mosaic/enforcement/pre-commit
  trigger: git_commit
- aliases:
  - Gate 4
  - Gate 8
  - Cross-Agent Approval
  - Gemini Approval
  condition: gemini_evaluates_work_meets_criteria
  description: Gemini evaluates Claude Code's work before marking complete
  domain: manual_ops
  enforcement_mode: semi-automatic
  evaluation_criteria:
  - Did agent run pre-handoff validation tests?
  - Do validation tests pass (6/6 or all âœ…)?
  - Are state files correct (last_commit matches git HEAD)?
  - Is handoff_message meaningful (>50 chars, explains what was done)?
  - Are all commits pushed to origin/main?
  - Did agent follow INTENT framework?
  - No absolute paths in documentation?
  fail_action: REQUEST_CHANGES or REJECT with required fixes
  id: GATE_4_GEMINI_EVAL
  name: Gemini Cross-Agent Evaluation
  pass_criteria: 'Gemini verdict: APPROVE (validation tests run, state files correct,
    handoff meaningful, commits pushed, INTENT followed)'
  script: .mosaic/enforcement/gate_4_gemini_eval.py
  severity: HIGH
  source_refs:
  - .mosaic/enforcement/FOUR_GATE_SYSTEM.md
  - .mosaic/enforcement/gate_4_gemini_eval.py
  trigger: before_handoff_commit
- aliases:
  - Gate 9
  - Production Health Check
  condition: production_backend_frontend_healthy
  description: Validates production services are healthy before push
  domain: pre_push_hook
  enforcement_mode: automatic
  fail_action: BLOCK push with production issue details
  id: GATE_9_PRODUCTION_CHECK
  name: Production Connectivity Check
  pass_criteria: Backend /health returns 200 ok=true, Frontend loads successfully,
    Git configs correct, Deployment URLs valid
  script: .mosaic/enforcement/gate_9_production_check.py
  severity: CRITICAL
  source_refs:
  - .mosaic/enforcement/pre-push
  - .mosaic/enforcement/gate_9_production_check.py
  trigger: git_push
  tests:
  - Backend health endpoint responds (200 ok=true)
  - Frontend loads successfully
  - Git remote URLs correct (not Railway, using Render)
  - Environment variables set correctly
  - Deployment configs valid (render.yaml, netlify.toml)
- aliases:
  - Gate 10
  - Smoke Tests
  - Post-Deploy Validation
  authority:
  - Google SRE Handbook
  - DORA Metrics
  - Test Pyramid (Martin Fowler)
  condition: production_smoke_tests_pass
  description: Validates deployed code actually works in production
  domain: runtime_watchdog
  enforcement_mode: automatic
  fail_action: BLOCK deployment and require manual rollback
  id: GATE_10_PRODUCTION_SMOKE
  name: Production Smoke Tests
  on_fail: alert_and_rollback
  pass_criteria: Basic health check (200), Health JSON valid (ok=true), New endpoints
    from commit deployed and working
  script: .mosaic/enforcement/gate_10_production_smoke.sh
  severity: CRITICAL
  source_refs:
  - .mosaic/enforcement/gate_10_production_smoke.sh
  trigger: post_deploy
  tests:
  - Backend /health responds (200)
  - Health JSON valid (ok=true)
  - New endpoints deployed (based on commit message)
  - Frontend accessible
- aliases:
  - Session Validator
  - Initialization Check
  checks:
  - State files exist and are valid JSON (.mosaic/agent_state.json, blockers.json,
    current_task.json, session_log.jsonl)
  - Current state information extracted (last_commit, current_agent, current_task,
    handoff_message)
  - Briefing acknowledgment field present in agent_state.json
  - Git state verified (last_commit in state matches actual HEAD)
  - User decisions loaded from state
  - Required documentation files exist (MANDATORY_AGENT_BRIEFING.md, CROSS_AGENT_PROTOCOL.md,
    etc.)
  condition: session_validation_checks_pass
  description: Validates AI agent session initialization before any work
  domain: human_check
  enforcement_mode: manual
  fail_action: BLOCK work until briefing acknowledged and state synchronized
  id: SESSION_GATE
  name: Session Initialization Gate
  pass_criteria: State files exist and valid, Current state extracted, Git state verified,
    Briefing acknowledgment present, Required docs exist
  script: .mosaic/enforcement/session-gate.sh
  severity: CRITICAL
  source_refs:
  - .mosaic/enforcement/session-gate.sh
  trigger: session_start
- aliases:
  - Context Manager Contract
  condition: 'with get_conn() as conn:'
  description: All database operations must use context manager pattern to prevent
    AttributeError
  domain: schema_contract
  enforcement_mode: runtime
  fail_action: AttributeError at runtime
  id: DATABASE_CONTEXT_MANAGER
  name: Database Context Manager Enforcement
  pass_criteria: Database connection uses context manager (with statement)
  severity: CRITICAL
  source_refs:
  - TROUBLESHOOTING_CHECKLIST.md
  - SELF_DIAGNOSTIC_FRAMEWORK.md
  trigger: always
- aliases:
  - SQL Parameter Contract
  condition: cursor.execute(..., %s, ...)
  description: SQL queries must use %s placeholders (PostgreSQL) not ? (SQLite)
  domain: schema_contract
  enforcement_mode: runtime
  fail_action: SQL syntax error at runtime
  id: POSTGRESQL_PARAMETER_SYNTAX
  name: PostgreSQL Parameter Placeholder Enforcement
  pass_criteria: SQL uses %s for parameters
  severity: HIGH
  source_refs:
  - TROUBLESHOOTING_CHECKLIST.md
  - SELF_DIAGNOSTIC_FRAMEWORK.md
  trigger: always
- aliases:
  - Cursor Contract
  condition: cursor = conn.cursor() before cursor.execute()
  description: Must call cursor = conn.cursor() before cursor.execute()
  domain: schema_contract
  enforcement_mode: runtime
  fail_action: AttributeError at runtime
  id: CURSOR_BEFORE_EXECUTE
  name: Cursor Must Be Obtained Before Execute
  pass_criteria: Cursor obtained from connection before use
  severity: CRITICAL
  source_refs:
  - TROUBLESHOOTING_CHECKLIST.md
  trigger: always
- aliases:
  - Idempotency Contract
  condition: INSERT ... ON CONFLICT or SELECT before INSERT
  description: Write operations should use ON CONFLICT or check-before-insert to
    be safely retryable
  domain: schema_contract
  enforcement_mode: best_practice
  fail_action: Duplicate key error on retry
  id: IDEMPOTENT_OPERATIONS
  name: Database Operations Must Be Idempotent
  pass_criteria: Operations can be run multiple times safely
  severity: MEDIUM
  source_refs:
  - SELF_DIAGNOSTIC_FRAMEWORK.md
  trigger: always
meta:
  enforcement_domains:
    human_check: 3
    manual_ops: 1
    pre_push_hook: 1
    repo_hook: 10
    runtime_watchdog: 3
    schema_contract: 4
  last_updated: '2026-01-15'
  normalization_notes:
  - Preserved all gates from original documentation
  - Gate 4 and Gate 8 are aliases (same Gemini evaluation gate)
  - Gate 3 expanded into sub-gates (3.1-3.7) to match pre-commit implementation
  - Added implicit schema contract gates for runtime enforcement patterns
  - All gates machine-parseable with standardized schema
  - Source refs preserved from original documents
  - 'Enforcement modes: automatic (git hooks), manual (human-run scripts), semi-automatic
    (agent-run with approval), runtime (code contracts), best_practice (recommendations)'
  schema_version: '1.0'
  severity_distribution:
    CRITICAL: 16
    HIGH: 4
    LOW: 1
    MEDIUM: 3
  total_gates: 22
version: '1.0'
